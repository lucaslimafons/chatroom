<div id="signUp">
  <img src="/images/logo-jobsity.png" class="mb-5 text-center">

  <div class="row justify-content-md-center">
    <h1 class="w-100 text-center">Sign Up</h1>

    <div class="col-6">
      <form @submit.prevent="signUp()">
        <div class="form-group" :class="{ 'text-danger': $v.model.username.$error }">
          <label for="username">Username</label>
          <input type="text"
            :class="{ 'is-invalid': $v.model.username.$error }"
            class="form-control"
            maxlength="20"
            v-model="model.username"
            aria-describedby="usernameHelp"
            placeholder="Username"
            @input="$v.model.username.$touch()">
        </div>

        <div class="form-group" :class="{ 'text-danger': $v.model.password.$error }">
          <label for="password">Password</label>
          <input type="password"
            :class="{ 'is-invalid': $v.model.username.$error }"
            class="form-control"
            maxlength="20"
            v-model="model.password"
            placeholder="Password"
            @input="$v.model.password.$touch()">
        </div>

        <button type="submit" class="btn btn-primary btn-block">Submit</button>

        <a href="/" class="mt-5 text-center">Already registered? Sign in!</a>
      </form>
    </div>
  </div>
</div>
<script>
  const { required, minLength } = window.validators

  let app = new Vue({
    el: '#signUp',
    data: {
      model: {
        username: '',
        password: ''
      }
    },
    validations: {
      model: {
      	username: {
        	required,
          minLength: minLength(2)
        },
        password: {
        	required,
          minLength: minLength(2)
        }
      }
    },
    methods: {
      async signUp() {
        let vm = this;

        if (this.$v.model.$invalid) {
          this.$v.model.$touch();
        } else {
          try {
            const ret = await authService.signUp(this.model);

            Toast.fire({
              icon: 'success',
              title: 'Signed up and in successfully, good chat :)'
            }).then(() => {
              window.location.href = '/chat';
            });
          } catch (e) {
            if (e && e.length > 0) {
              for (let error of e) {
                Toast.fire({
                  icon: 'error',
                  title: error.message
                });
              }
            }
          }
        }
      }
    },
    beforeMount() {
      if (authService.isLoggedIn()) {
        window.location.href = '/chat';
      }
    }
  });
</script>
